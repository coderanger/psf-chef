# Generated by Chef
# Local modifications will be overwritten

server {
  listen 80;
  server_name <%= @domains.join(" ") %>;

  <% if @hsts_seconds %>
  add_header Strict-Transport-Security "max-age=<%= @hsts_seconds %>";
  <% end %>

  # TODO: Cache Static Assests
  # TODO: Host Packages

  location /static/ {
    alias <%= @static_root %>/;
  }

  location ~* ^/(pypi|daytime|mirrors|id|oauth|security|simple|serversig).* {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect   off;

    proxy_pass       http://localhost:8000;
  }
}
